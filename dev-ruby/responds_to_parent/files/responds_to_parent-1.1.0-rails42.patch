From 3bd407ef92c7fd8aecb1425f46b0e1f5d83e17c6 Mon Sep 17 00:00:00 2001
From: Jon Cairns <jcairns@intellum.com>
Date: Wed, 24 Feb 2016 10:56:43 +0000
Subject: [PATCH] Compatibility for rails 4.2+

Don't reference removed test modules, and update dependent gems.
---
 Gemfile                       |  4 +--
 Gemfile.lock                  | 74 +++++++++++++++++++++++++++----------------
 gemfiles/rails23.gemfile      |  2 +-
 gemfiles/rails23.gemfile.lock |  5 ++-
 gemfiles/rails30.gemfile      |  2 +-
 gemfiles/rails30.gemfile.lock |  5 ++-
 lib/responds_to_parent.rb     |  5 ++-
 test/test_helper.rb           |  3 +-
 8 files changed, 65 insertions(+), 35 deletions(-)

diff --git a/Gemfile b/Gemfile
index d9280cd..405c48e 100644
--- a/Gemfile
+++ b/Gemfile
@@ -1,6 +1,6 @@
-source :rubygems
+source "https://rubygems.org"
 
 gem "appraisal"
 gem "rake"
-gem "actionpack", "3.0.15"
+gem "actionpack", "~> 4.1"
 gem "test-unit", ">=2.5.1"
diff --git a/Gemfile.lock b/Gemfile.lock
index 487feb3..b086268 100644
--- a/Gemfile.lock
+++ b/Gemfile.lock
@@ -1,43 +1,63 @@
 GEM
-  remote: http://rubygems.org/
+  remote: https://rubygems.org/
   specs:
-    abstract (1.0.0)
-    actionpack (3.0.15)
-      activemodel (= 3.0.15)
-      activesupport (= 3.0.15)
-      builder (~> 2.1.2)
-      erubis (~> 2.6.6)
-      i18n (~> 0.5.0)
-      rack (~> 1.2.5)
-      rack-mount (~> 0.6.14)
-      rack-test (~> 0.5.7)
-      tzinfo (~> 0.3.23)
-    activemodel (3.0.15)
-      activesupport (= 3.0.15)
-      builder (~> 2.1.2)
-      i18n (~> 0.5.0)
-    activesupport (3.0.15)
+    actionpack (4.2.5.1)
+      actionview (= 4.2.5.1)
+      activesupport (= 4.2.5.1)
+      rack (~> 1.6)
+      rack-test (~> 0.6.2)
+      rails-dom-testing (~> 1.0, >= 1.0.5)
+      rails-html-sanitizer (~> 1.0, >= 1.0.2)
+    actionview (4.2.5.1)
+      activesupport (= 4.2.5.1)
+      builder (~> 3.1)
+      erubis (~> 2.7.0)
+      rails-dom-testing (~> 1.0, >= 1.0.5)
+      rails-html-sanitizer (~> 1.0, >= 1.0.2)
+    activesupport (4.2.5.1)
+      i18n (~> 0.7)
+      json (~> 1.7, >= 1.7.7)
+      minitest (~> 5.1)
+      thread_safe (~> 0.3, >= 0.3.4)
+      tzinfo (~> 1.1)
     appraisal (0.4.1)
       bundler
       rake
-    builder (2.1.2)
-    erubis (2.6.6)
-      abstract (>= 1.0.0)
-    i18n (0.5.0)
-    rack (1.2.5)
-    rack-mount (0.6.14)
-      rack (>= 1.0.0)
-    rack-test (0.5.7)
+    builder (3.2.2)
+    erubis (2.7.0)
+    i18n (0.7.0)
+    json (1.8.3)
+    loofah (2.0.3)
+      nokogiri (>= 1.5.9)
+    mini_portile2 (2.0.0)
+    minitest (5.8.4)
+    nokogiri (1.6.7.2)
+      mini_portile2 (~> 2.0.0.rc2)
+    rack (1.6.4)
+    rack-test (0.6.3)
       rack (>= 1.0)
+    rails-deprecated_sanitizer (1.0.3)
+      activesupport (>= 4.2.0.alpha)
+    rails-dom-testing (1.0.7)
+      activesupport (>= 4.2.0.beta, < 5.0)
+      nokogiri (~> 1.6.0)
+      rails-deprecated_sanitizer (>= 1.0.1)
+    rails-html-sanitizer (1.0.3)
+      loofah (~> 2.0)
     rake (0.9.2.2)
     test-unit (2.5.1)
-    tzinfo (0.3.33)
+    thread_safe (0.3.5)
+    tzinfo (1.2.2)
+      thread_safe (~> 0.1)
 
 PLATFORMS
   ruby
 
 DEPENDENCIES
-  actionpack (= 3.0.15)
+  actionpack (~> 4.1)
   appraisal
   rake
   test-unit (>= 2.5.1)
+
+BUNDLED WITH
+   1.11.2
diff --git a/gemfiles/rails23.gemfile b/gemfiles/rails23.gemfile
index a5c69d5..ba065b8 100644
--- a/gemfiles/rails23.gemfile
+++ b/gemfiles/rails23.gemfile
@@ -1,6 +1,6 @@
 # This file was generated by Appraisal
 
-source :rubygems
+source "https://rubygems.org"
 
 gem "appraisal"
 gem "rake"
diff --git a/gemfiles/rails23.gemfile.lock b/gemfiles/rails23.gemfile.lock
index ea4258e..8a97973 100644
--- a/gemfiles/rails23.gemfile.lock
+++ b/gemfiles/rails23.gemfile.lock
@@ -1,5 +1,5 @@
 GEM
-  remote: http://rubygems.org/
+  remote: https://rubygems.org/
   specs:
     actionpack (2.3.14)
       activesupport (= 2.3.14)
@@ -22,3 +22,6 @@ DEPENDENCIES
   iconv
   rake
   test-unit (>= 2.5.1)
+
+BUNDLED WITH
+   1.11.2
diff --git a/gemfiles/rails30.gemfile b/gemfiles/rails30.gemfile
index bb1ca7c..26ffd77 100644
--- a/gemfiles/rails30.gemfile
+++ b/gemfiles/rails30.gemfile
@@ -1,6 +1,6 @@
 # This file was generated by Appraisal
 
-source :rubygems
+source "https://rubygems.org"
 
 gem "appraisal"
 gem "rake"
diff --git a/gemfiles/rails30.gemfile.lock b/gemfiles/rails30.gemfile.lock
index 487feb3..d4a5ee0 100644
--- a/gemfiles/rails30.gemfile.lock
+++ b/gemfiles/rails30.gemfile.lock
@@ -1,5 +1,5 @@
 GEM
-  remote: http://rubygems.org/
+  remote: https://rubygems.org/
   specs:
     abstract (1.0.0)
     actionpack (3.0.15)
@@ -41,3 +41,6 @@ DEPENDENCIES
   appraisal
   rake
   test-unit (>= 2.5.1)
+
+BUNDLED WITH
+   1.11.2
diff --git a/lib/responds_to_parent.rb b/lib/responds_to_parent.rb
index 885b7be..26afd24 100644
--- a/lib/responds_to_parent.rb
+++ b/lib/responds_to_parent.rb
@@ -3,7 +3,10 @@
 
 ActionController::Base.send :include, RespondsToParent::ActionController
 
-base = if ActionPack::VERSION::MAJOR >= 3
+base = if ActionPack::VERSION::MAJOR >= 4
+  require "active_support/testing/assertions"
+  ActiveSupport::Testing::Assertions
+elsif ActionPack::VERSION::MAJOR == 3
   ActionDispatch::Assertions::SelectorAssertions
 else
   ActionController::Assertions::SelectorAssertions
diff --git a/test/test_helper.rb b/test/test_helper.rb
index 31bc974..22d99a6 100644
--- a/test/test_helper.rb
+++ b/test/test_helper.rb
@@ -11,7 +11,8 @@
 
   ROUTES = ActionDispatch::Routing::RouteSet.new
   ROUTES.draw do
-    match ':controller(/:action(/:id(.:format)))'
+    get ':controller(/:action(/:id(.:format)))'
+    post ':controller(/:action(/:id(.:format)))'
   end
   ROUTES.finalize!
 
